<!DOCTYPE html>
<html lang="en">
<head>
<title>新增用户</title>
<meta name="decorator" content="form" />
</head>

<body>
	<div class="breadcrumbs" id="breadcrumbs">
		<script type="text/javascript">
							try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
						</script>

		<ul class="breadcrumb">
			<li><i class="ace-icon fa fa-home home-icon"></i> <a
				href="${ctx}/home">主页</a></li>

			<li><a href="#">项目管理</a></li>
			<li><a href="#">我的工作</a></li>
			<li class="active">工作详情</li>
		</ul>
		<!-- /.breadcrumb -->

		<!-- /section:basics/content.searchbox -->
	</div>

	<!-- /section:basics/content.breadcrumbs -->
	<div class="page-content">

		<!-- /section:settings.box -->
		<div class="page-header">
			<h1>
				项目管理 <small> <i class="ace-icon fa fa-angle-double-right"></i>
					我的工作
				</small><small> <i class="ace-icon fa fa-angle-double-right"></i>
					工作详情
				</small>
			</h1>
		</div>
		<!-- /.page-header -->

		<div class="row">
			<div class="col-xs-12">
				<h2 class="lighter block green">项目基本信息</h2>
				<form class="form-horizontal" role="form">
					<div class="form-group">
						<label class="col-sm-3 control-label no-padding-right">
							项目编号 :</label>

						<div class="col-sm-9">
							<label class="col-sm-3 control-label no-padding-right"
								style="text-align: left"> ${projectInfo.projectNum}</label>
						</div>
					</div>

					<div class="space-2"></div>

					<div class="form-group">
						<label class="col-sm-3 control-label no-padding-right">
							项目名称 :</label>

						<div class="col-sm-9">
							<label class="col-sm-3 control-label no-padding-right"
								style="text-align: left"> ${projectInfo.projectName} </label>
						</div>
					</div>

					<div class="space-2"></div>

					<div class="form-group">
						<label class="col-sm-3 control-label no-padding-right">
							项目类型 :</label>

						<div class="col-sm-9">
							<label class="col-sm-3 control-label no-padding-right"
								style="text-align: left"> ${projectInfo.typeName} </label>
						</div>
					</div>

					<div class="space-2"></div>

					<div class="form-group">
						<label class="col-sm-3 control-label no-padding-right">
							项目负责人 :</label>

						<div class="col-sm-9">
							<label class="col-sm-3 control-label no-padding-right"
								style="text-align: left"> ${projectInfo.leaderName} </label>
						</div>
					</div>

					<div class="space-2"></div>

					<div class="form-group">
						<label class="col-sm-3 control-label no-padding-right">
							项目负责公司 :</label>

						<div class="col-sm-9">
							<label class="col-sm-3 control-label no-padding-right"
								style="text-align: left"> ${projectInfo.company} </label>
						</div>
					</div>

					<div class="space-2"></div>

					<div class="form-group">
						<label class="col-sm-3 control-label no-padding-right">
							项目当前状态 :</label>

						<div class="col-sm-9">
							<label class="col-sm-3 control-label no-padding-right"
								style="text-align: left"> ${projectInfo.status} </label>
						</div>
					</div>

					<div class="space-2"></div>

					<div class="form-group">
						<label class="col-sm-3 control-label no-padding-right">
							项目录入人员 :</label>

						<div class="col-sm-9">
							<label class="col-sm-3 control-label no-padding-right"
								style="text-align: left">
								${projectInfo.entryStaffAccount} </label>
						</div>
					</div>

					<div class="space-2"></div>

					<div class="form-group">
						<label class="col-sm-3 control-label no-padding-right">
							项目录入时间 :</label>

						<div class="col-sm-9">
							<label class="col-sm-3 control-label no-padding-right"
								style="text-align: left">
								${projectInfo.createTime?string("yyyy-MM-dd")} </label>
						</div>
					</div>

					<div class="space-2"></div>

					<div class="form-group">
						<label class="col-sm-3 control-label no-padding-right">
							项目简述 :</label>

						<div class="col-sm-9"
							style="word-wrap: break-word; word-break: normal;">
							<label class="col-sm-3 control-label no-padding-right"
								style="text-align: left"> ${projectInfo.description}</label>
						</div>
					</div>

					<div class="form-group">
						<label class="col-sm-3 control-label no-padding-right">
							项目起止时间 :</label>

						<div class="col-sm-9"
							style="word-wrap: break-word; word-break: normal;">
							<label class="col-sm-3 control-label no-padding-right"
								style="text-align: left">
								${projectInfo.projectStartDate?string("yyyy-MM-dd")}</br>到${projectInfo.projectEndDate?string("yyyy-MM-dd")}
							</label>
						</div>
					</div>
				</form>
			</div>


		</div>

		<div class="hr hr-dotted"></div>

		<div class="row">
			<div class="col-xs-12">&nbsp;&nbsp;&nbsp;</div>
		</div>

		<div class="row">
			<div class="col-xs-12">
				<!-- PAGE CONTENT BEGINS -->
				<h3 class="lighter block green">我的工作内容</h3>
				<div class="col-xs-12">
					<#if workInfo.status=0>
					<button class="btn btn-sm btn-purple" data-toggle="modal"
						data-target="#modify_period-modal" href="javascript:void(0)"
						onclick="modifyPeriodInfo('${workInfo.id}','${projectInfo.projectStartDate?string("yyyy-MM-dd")}','${workInfo.periodEndDate?string("yyyy-MM-dd")}')">
						<i class="icon-edit bigger-120"></i>修改阶段时间
					</button>
					</#if>
					&nbsp;&nbsp;&nbsp;
					<#if workInfo.status=0&&projectInfo.status==workInfo.period>
					<button class="btn btn-sm btn-purple" data-toggle="modal"
						data-target="#finish_process-modal" href="javascript:void(0)"
						onclick="finishProcess('${projectInfo.id}','${processId}','${projectInfo.status}','${workInfo.id}')">
						<i class="icon-edit bigger-120"></i>结束当前流程
					</button>
					</#if>
				</div>

				<form class="form-horizontal" role="form">
					<div class="form-group">
						<label class="col-sm-3 control-label no-padding-right">
							阶段名称 :</label>

						<div class="col-sm-9">
							<label class="col-sm-3 control-label no-padding-right"
								style="text-align: left"> ${workInfo.periodName} </label>
						</div>
					</div>

					<div class="space-2"></div>

					<div class="form-group">
						<label class="col-sm-3 control-label no-padding-right">
							阶段负责人 :</label>

						<div class="col-sm-9">
							<label class="col-sm-3 control-label no-padding-right"
								style="text-align: left"> ${Session.userName} </label>
						</div>
					</div>

					<div class="space-2"></div>

					<div class="form-group">
						<label class="col-sm-3 control-label no-padding-right">
							当前状态 :</label>

						<div class="col-sm-9">
							<label class="col-sm-3 control-label no-padding-right"
								style="text-align: left"> <#if workInfo.status=1>已完成<#elseif
									workInfo.status=0>未完成</#if>
							</label>
						</div>
					</div>

					<div class="space-2"></div>

					<div class="form-group">
						<label class="col-sm-3 control-label no-padding-right">
							阶段开始时间 :</label>

						<div class="col-sm-9">
							<label class="col-sm-3 control-label no-padding-right"
								style="text-align: left">
								${workInfo.periodStartDate?string("yyyy-MM-dd")} </label>
						</div>
					</div>

					<div class="space-2"></div>

					<div class="form-group">
						<label class="col-sm-3 control-label no-padding-right">
							阶段完成时间 :</label>

						<div class="col-sm-9"
							style="word-wrap: break-word; word-break: normal;">
							<label class="col-sm-3 control-label no-padding-right"
								style="text-align: left">
								${workInfo.periodEndDate?string("yyyy-MM-dd")}</label>
						</div>
					</div>
				</form>


				<div id="timeline-2">
					<div class="row">
						<div class="col-xs-12 col-sm-10 col-sm-offset-1">
							<!-- #section:pages/timeline.style2 -->
							<div class="timeline-container timeline-style2">
								<span class="timeline-label"> <b>该阶段流程</b>
								</span>

								<div class="timeline-items">
									<#list processList as process>
									<div class="timeline-item clearfix">
										<div class="timeline-info">
											<span class="timeline-date">${process.processName}</span> <i
												class="timeline-indicator btn btn-info no-hover"></i>
										</div>

										<div class="widget-box transparent">
											<div class="widget-body">
												<div class="widget-main no-padding">
													<#if process.status=1>已完成，流程备注：${process.remark}<#elseif
														process.status=0>[未完成]</#if>
												</div>
											</div>
										</div>
									</div>
									</#list>
								</div>
								<!-- /.timeline-items -->
							</div>
							<!-- /.timeline-container -->
						</div>
						<!-- /.timeline-container -->
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- /.page-content -->

	<div id="modify_period-modal" class="modal fade" tabindex="-1"
		function="dialog">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="blue bigger">修改阶段起止时间</h4>
				</div>
				<div class="modal-body overflow-visible">
					<form class="form-inline" action="${ctx}/period/modifyPeriodInfo"
						id="modify_project-form" method="post">
						<div class="row">
							<div class="col-xs-12">
								<!-- PAGE CONTENT BEGINS -->
								<div class="from-group">
									<div class="input-group">
										<input type="hidden" id="periodid" name="id"
											class="col-xs-10 col-sm-5" value="" /> <label
											class="col-sm-3 control-label no-padding-right">阶段开始日期:</label>
										<div class="col-sm-7">
											<input type="text" id="periodStartDate"
												name="periodStartDate" class="col-xs-10 col-sm-5 datepicker"
												value="" required />
										</div>

										<label class="col-sm-3 control-label no-padding-right">阶段完成日期:</label>
										<div class="col-sm-7">
											<input type="text" id="periodEndDate" name="periodEndDate"
												class="col-xs-10 col-sm-5 datepicker" value="" required />
										</div>
									</div>
								</div>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button class="btn btn-sm btn-info"
						onclick="$('#modify_project-form').submit();">
						<i class="icon-ok"></i> 提交
					</button>
					<button class="btn btn-sm" data-dismiss="modal">
						<i class="icon-remove"></i> 取消
					</button>
				</div>
			</div>
		</div>
	</div>

	<div id="finish_process-modal" class="modal fade" tabindex="-1"
		function="dialog">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="blue bigger">结束当前流程</h4>
				</div>
				<div class="modal-body overflow-visible">
					<form class="form-inline"
						action="${ctx}/project/finishProjectProcess"
						id="finish_process-form" method="post">
						<div class="row">
							<div class="col-xs-12">
								<!-- PAGE CONTENT BEGINS -->
								<div class="from-group">
									<div class="input-group">
										<input type="hidden" id="projectId" name="projectId" value=""
											class="col-xs-12 col-sm-5" /> <input type="hidden"
											id="period" name="period" value="" class="col-xs-12 col-sm-5" />
										<input type="hidden" id="processId" name="processId" value=""
											class="col-xs-12 col-sm-5" /> <input type="hidden"
											id="periodId" name="periodId" value=""
											class="col-xs-12 col-sm-5" /> <label
											class="col-sm-3 control-label no-padding-right">当前流程工作备注:</label>
										<div class="col-sm-7">
											<textarea class="input-xlarge" name="remark" required></textarea>
										</div>
									</div>
								</div>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button class="btn btn-sm btn-info"
						onclick="$('#finish_process-form').submit();">
						<i class="icon-ok"></i> 提交
					</button>
					<button class="btn btn-sm" data-dismiss="modal">
						<i class="icon-remove"></i> 取消
					</button>
				</div>
			</div>
		</div>
	</div>

	<script type="text/javascript">
		$(function() {
			$(".datepicker").datepicker({
	            language: "zh-CN",
	            autoclose: true,//选中之后自动隐藏日期选择框
	            clearBtn: true,//清除按钮
	            format: "yyyy-mm-dd"//日期格式，详见 http://bootstrap-datepicker.readthedocs.org/en/release/options.html#format
	        });
			
			$("#modify_project-form").validate();
			$("#modify_project-form").bind('submit', function() {
				//校验表单
				if (!$(this).valid()) {
					return false;
				}
				ajaxSubmit(this, function(response) {
					response = $.parseJSON(response);
					if (response.status == 1) {
						alert("修改成功！");
						//window.open("${ctx}/portal_user/show_user_list");
						window.location.reload();
					} else {
						alert(response.errormsg);
					}
				});
				return false;
			});
			$("#finish_process-form").validate();
			$("#finish_process-form").bind('submit', function() {
				//校验表单
				if (!$(this).valid()) {
					return false;
				}
				ajaxSubmit(this, function(response) {
					response = $.parseJSON(response);
					if (response.status == 1) {
						alert("当前流程已完成！项目已进入下一流程！");
						//window.open("${ctx}/portal_user/show_user_list");
						window.location.reload();
					} else {
						alert(response.errormsg);
					}
				});
				return false;
			});
		});
		
		function modifyPeriodInfo(id, periodStartDate, periodEndDate) {
			//alert(id+","+period+","+periodNmae+","+processName+","+description);
			$("#periodid").val(id);
			$("#periodStartDate").val(periodStartDate);
			$("#periodEndDate").val(periodEndDate);
		}
		function finishProcess(projectId, processId, period,periodId) {
			//alert(id+","+period+","+periodNmae+","+processName+","+description);
			$("#projectId").val(projectId);
			$("#processId").val(processId);
			$("#period").val(period);
			$("#periodId").val(periodId);
		}
	</script>
</body>
</html>
